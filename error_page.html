<!DOCTYPE HTML>
<html>
  <head>
    <title>Please retry..</title>
  </head>
  <body>
    <p id="message">Please click <a href="#" target="_top" id="anchor">this link</a> if you are not redirected within a few seconds...</p>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
      var link = document.createElement('link');
      link.setAttribute('rel', 'canonical');
      link.setAttribute('href', document.referrer);
      document.head.appendChild(link);

      var anchor = document.getElementById('anchor');
      anchor.href = document.referrer;
      var check = function() {
        UrlExists(anchor.href, status => {
          console.log('status', status);

          switch (status) {
            case 503:
              setTimeout(check, 1000);
              break;

            case 200:
            case 0:
              anchor.click();
              break;

            default:
              break;
          }
        });
      }
      check();

      function UrlExists(url, cb) {
        jQuery.ajax({
          url:      url,
          dataType: 'text',
          type:     'GET',
          complete: function(xhr) {
            if (typeof cb === 'function') cb.apply(this, [xhr.status]);
          }
        });
      }
    </script>
  </body>
</html>
